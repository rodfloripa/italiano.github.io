<!DOCTYPE html>
<html>
<head>
  <title>Reggenza verbale</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Este site pode ser utilizado para verificar se conhecemos a regencia de alguns verbos em italiano">
  <meta name="keywords" content="italiano,regencia verbal,italiano para brasileiros">
  <style>
    #progress-bar {
      width: 200px;
      height: 20px;
      background-color: #ccc;
      border-radius: 10px;
    }
    #progress-bar-fill {
      height: 20px;
      background-color: #4CAF50;
      border-radius: 10px;
    }
    #file-input-label {
      font-size: 18px;
      padding: 10px 20px;
      border: 1px solid #ccc;
      border-radius: 5px;
      cursor: pointer;
    }
    #group-list {
      font-size: 18px;
      padding: 10px 20px;
    }
    #prev-card, #next-card, #lista-button, #limpar-button {
      font-size: 24px;
      padding: 15px 30px;
      width: 200px;
    }
    @media only screen and (max-width: 768px) {
      #prev-card, #next-card, #lista-button, #limpar-button {
        font-size: 18px;
        padding: 5px 10px;
        width: 47%;
      }
      #file-input-label {
        font-size: 16px;
        padding: 8px 16px;
      }
      #group-list {
        font-size: 16px;
        padding: 8px 16px;
      }
      #card-content {
        font-size: 24px;
      }
      #progress-bar {
        width: 150px;
        height: 15px;
      }
      #progress-bar-fill {
        height: 15px;
      }
    }
  </style>
</head>
<body>
  <h1>Vocabolario</h1>
  <button id="help-button" style="width: 50px; height: 30px;" onclick="exibirMensagem()">?</button>
  <label for="file-input" id="file-input-label">Caricare</label>
  <input type="file" id="file-input" style="display: none;" accept=".txt">
  <div id="progress-bar">
    <div id="progress-bar-fill" style="width: 0%;"></div>
  </div>
  <p id="progress-text">0.00%</p>
  <select id="group-list"></select>
  <div style="display: block; text-align: left;">
    <button id="prev-card" style="margin-right: 10px; margin-bottom: 10px;">precedente</button>
    <button id="next-card" style="margin-bottom: 10px;">successivo</button>
  </div>
  <div style="display: block; text-align: left;">
    <button id="lista-button" style="margin-right: 10px;">lista</button>
    <button id="limpar-button">pulire lista</button>
  </div>
  <div id="card">
    <div style="text-align: center;">
      <input type="checkbox" id="sbagliato-checkbox">
      <label for="sbagliato-checkbox">ho sbagliato</label>
    </div>
    <div id="card-content"></div>
  </div>
 
</body>


  
<script>
                                 
let flashcards = {};
let currentGroup = null;
let currentCardIndex = 0;
let lezione = null;
let listaIndex = 0;
let lista = [];

function loadFlashcards(file) {
  let reader = new FileReader();
  reader.onload = function(event) {
    let txt = event.target.result;
    let lines = txt.split("\n");
    let vocabolario = lines[0].trim();
    lezione = lines[1].trim();
    document.title = vocabolario;
    document.querySelector("h1").innerText = vocabolario;
    txt = txt.replace(/Vocabolario/g, vocabolario);
    txt = txt.replace(/Lezione/g, lezione);
    let group = null;
    let groupName = null;
    lines = txt.split("\n");
    flashcards = {};
    let newFlashcards = {};
    lines.forEach(line => {
      if (line.match(/^(Lezione|Grupo)/)) {
        group = line.trim();
        let groupNumber = line.trim().replace("Grupo", "").replace("Lezione", "");
        groupName = lezione + groupNumber;
        flashcards[group] = [];
        newFlashcards[groupName] = [];
      } else if (group && line.trim() !== "") {
        let sides = line.split("-");
        if (sides.length === 2) {
          flashcards[group].push({ pergunta: sides[0].trim(), resposta: sides[1].trim() });
          newFlashcards[groupName].push({ pergunta: sides[0].trim(), resposta: sides[1].trim() });
        }
      }
    });
    flashcards = newFlashcards;
    showGroups();
  };
  reader.readAsText(file);
}

function showGroups() {
  let groupList = document.getElementById("group-list");
  groupList.innerHTML = "";
  Object.keys(flashcards).forEach(group => {
    let option = document.createElement("option");
    option.value = group;
    option.text = group;
    groupList.appendChild(option);
  });
  document.getElementById("group-list").onchange = showFlashcards;
  groupList.value = Object.keys(flashcards)[1];
  showFlashcards();
}

function showFlashcards() {
  currentGroup = document.getElementById("group-list").value;
  currentCardIndex = 0;
  document.getElementById("sbagliato-checkbox").checked = false;
  showCard();
}

function showCard() {
  let card = flashcards[currentGroup][currentCardIndex];
  let progresso = ((currentCardIndex + 1) / flashcards[currentGroup].length) * 100;
  document.getElementById("progress-bar-fill").style.width = `${progresso}%`;
  document.getElementById("progress-text").innerText = `${progresso.toFixed(2)}%`;
  document.getElementById("card-content").innerHTML = `
    <div style="background-color: yellow; padding: 10px; text-align: center; font-size: 52px; line-height: 1; width: 40%; margin: 0 auto;">
      <p>${card.pergunta}</p>
      <button onclick="showAnswer()" style="font-size: 36px;">Risposta</button>
      <div id="answer" style="max-height: 0; overflow: hidden; transition: max-height 0.5s ease-out; font-size: 52px;">${card.resposta}</div>
    </div>
  `;
}

function showAnswer() {
  let answer = document.getElementById("answer");
  if (answer.style.maxHeight === "0px" || answer.style.maxHeight === "") {
    answer.style.maxHeight = "500px";
    answer.style.transition = "max-height 0.5s ease-in";
  } else {
    answer.style.maxHeight = "0px";
    answer.style.transition = "max-height 0.5s ease-out";
  }
}

function nextCard() {
  document.getElementById("sbagliato-checkbox").checked = false;
  currentCardIndex++;
  if (currentCardIndex >= flashcards[currentGroup].length) {
    let groups = Object.keys(flashcards);
    let currentIndex = groups.indexOf(currentGroup);
    if (currentIndex === groups.length - 1) {
      currentIndex = 0;
    } else {
      currentIndex++;
    }
    currentGroup = groups[currentIndex];
    currentCardIndex = 0;
    document.getElementById("group-list").value = currentGroup;
  }
  showCard();
}


function prevCard0() {
  document.getElementById("sbagliato-checkbox").checked = false;
  currentCardIndex--;
  if (currentCardIndex < 0) {
    let groups = Object.keys(flashcards);
    let currentIndex = groups.indexOf(currentGroup);
    if (currentIndex === 0) {
      currentIndex = groups.length - 1;
    } else {
      currentIndex--;
    }
    currentGroup = groups[currentIndex];
    currentCardIndex = flashcards[currentGroup].length - 1;
    document.getElementById("group-list").value = currentGroup;
  }
  showCard();
}

function showListaCard() {
  if (lista.length > 0) {
    let card = lista[listaIndex];
    document.getElementById("card-content").innerHTML = `
      <div style="background-color: yellow; padding: 10px; text-align: center; font-size: 52px; line-height: 1; width: 40%; margin: 0 auto;">
        <p>${card.pergunta}</p>
        <button onclick="showAnswerLista()" style="font-size: 36px;">Risposta</button>
        <div id="answer-lista" style="max-height: 0; overflow: hidden; transition: max-height 0.5s ease-out; font-size: 52px;">${card.resposta}</div>
      </div>
    `;
  } else {
    document.getElementById("card-content").innerHTML = "Lista vazia";
  }
}

function nextListaCard() {
  listaIndex++;
  if (listaIndex >= lista.length) {
    listaIndex = 0;
  }
  showListaCard();
}

function prevListaCard() {
  listaIndex--;
  if (listaIndex < 0) {
    listaIndex = lista.length - 1;
  }
  showListaCard();
}

document.getElementById("file-input").addEventListener("change", function(event) {
  loadFlashcards(event.target.files[0]);
});

document.getElementById("next-card").onclick = function() {
  if (lista.length > 0 && document.getElementById("lista-button").style.backgroundColor === "green") {
    nextListaCard();
  } else {
    nextCard();
  }
};

function prevCard() {
  if (lista.length > 0 && document.getElementById("lista-button").style.backgroundColor === "green") {
    prevListaCard();
  } else {
    prevCard0();
  }
}

document.getElementById("sbagliato-checkbox").onchange = function() {
  let card = flashcards[currentGroup][currentCardIndex];
  if (this.checked) {
    if (localStorage.getItem("lista")) {
      try {
        lista = JSON.parse(localStorage.getItem("lista"));
      } catch (e) {
        lista = [];
      }
    } else {
      lista = [];
    }
    lista.push({ pergunta: card.pergunta, resposta: card.resposta });
    localStorage.setItem("lista", JSON.stringify(lista));
  } else {
    if (localStorage.getItem("lista")) {
      try {
        lista = JSON.parse(localStorage.getItem("lista"));
      } catch (e) {
        lista = [];
      }
      lista = lista.filter(item => item.pergunta !== card.pergunta || item.resposta !== card.resposta);
      localStorage.setItem("lista", JSON.stringify(lista));
    }
  }
  showCard();
};

document.getElementById("lista-button").onclick = function() {
  if (localStorage.getItem("lista") && localStorage.getItem("lista") !== "") {
    try {
      lista = JSON.parse(localStorage.getItem("lista"));
      listaIndex = 0;
      showListaCard();
      this.style.backgroundColor = "green";
      document.getElementById("limpar-button").style.backgroundColor = "";
    } catch (e) {
      console.log("Erro ao parsear lista:", e);
      lista = [];
      
    }
  } else {
    lista = [];
    
  }
}

document.getElementById("limpar-button").onclick = function() {
  localStorage.removeItem("lista");
  lista = [];
  document.getElementById("card-content").innerHTML = "";
  this.style.backgroundColor = "";
  this.style.backgroundColor = "green";
  document.getElementById("lista-button").style.backgroundColor = "";
}

document.getElementById("prev-card").onclick = function() {
  if (lista.length > 0 && document.getElementById("lista-button").style.backgroundColor === "green") {
    prevListaCard();
  } else {
    prevCard();
  }
};

function showAnswerLista() {
  let answer = document.getElementById("answer-lista");
  if (answer.style.maxHeight === "0px" || answer.style.maxHeight === "") {
    answer.style.maxHeight = "500px";
    answer.style.transition = "max-height 0.5s ease-in";
  } else {
    answer.style.max
    }}

function exibirMensagem() {
  alert("Para criar sua própria lista de vocabulário, crie um arquivo .txt assim:\nTítulo do vocabulário\nLezione\nGrupo 1\nPalavra port - Palavra it\n.\n.\n.");
}

window.onload = function() {
      fetch('Reggenza.txt')
        .then(response => response.text())
        .then(text => {
          let file = new File([text], 'arq.txt', {
            type: 'text/plain'
          });
          loadFlashcards(file);
        })
        .catch(error => console.error('Erro ao carregar arquivo:', error));
    }
     
  </script>
</body>
</html>
